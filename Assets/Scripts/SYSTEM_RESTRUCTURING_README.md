# 게임 시스템 구조 개편 문서

## 개요

이 문서는 간호시뮬레이션 게임의 데이터 시스템 구조 개편에 대한 내용을 설명합니다. 기존의 NursingActionData, InteractionData, ProcedureData 시스템을 Nursing 네임스페이스를 기반으로 한 새로운 구조로 개편했습니다.

## 네임스페이스 구조

시스템은 다음과 같은 네임스페이스 구조로 구성되어 있습니다:

- `Nursing.Interaction`: 인터랙션 관련 데이터 및 클래스
- `Nursing.Procedure`: 프로시저 관련 데이터 및 클래스
- `Nursing.Penalty`: 패널티 관련 데이터 및 클래스
- `Nursing.Scoring`: 점수 관련 시스템
- `Nursing.Managers`: 각종 관리자 클래스
- `Nursing.Editor`: 에디터 기능 클래스

## 핵심 컴포넌트

### 1. 인터랙션 데이터 (InteractionData)

인터랙션 데이터는 아이템 클릭 시 발생하는 인터랙션과 인터랙션 스테이지를 관리합니다.

주요 기능:
- `pickUpItem` 함수를 통해 특정 아이템이 호출될 때 트리거
- 각 인터랙션 스테이지에 대한 가이드 메시지
- 시퀀스 스테이지 정의 (필수 순서 및 선택적 순서)
- 여러 인터랙션 타입 지원:
  - 드래그 인터랙션
  - 오브젝트 생성
  - 조건부 클릭
  - 지속 클릭
  - 오브젝트 삭제
  - 오브젝트 이동
  - 퀴즈 팝업
  - 미니게임 팝업

### 2. 프로시저 데이터 (ProcedureData)

프로시저 데이터는 기술적 절차의 순서와 확인을 관리합니다.

주요 기능:
- 아이템 클릭 (InteractionData와 연결)
- 씬 "액션" 버튼 클릭
- 특정 순서가 필요한 중요 시퀀스
- 순서가 중요하지 않은 유연한 시퀀스

### 3. 프로시저 타입 (ProcedureType)

프로시저 타입은 현재 활성화된 기술적 절차를 식별합니다.

주요 기능:
- 적절한 ProcedureData ScriptableObject 연결
- "가이드라인 버전"과 "임상 버전" 구분

### 4. 패널티 시스템

패널티 시스템은 오류 발생 시 피드백과 기록을 관리합니다.

주요 기능:
- `DialogueManager.ShowSmallDialogue`를 통한 패널티 메시지 표시
- 여러 화자에 따른 패널티 상황 처리
- 패널티 데이터베이스 기록
- 화면 가장자리를 빨간색으로 깜빡이는 시각 효과
- 패널티 해결 전까지 다음 단계로의 진행 차단

## 관리자 클래스

### 1. InteractionManager

인터랙션과 인터랙션 스테이지의 실행을 관리합니다.

주요 기능:
- 인터랙션 시작 및 단계 진행
- 각 인터랙션 타입에 맞는 처리
- 아이템 클릭 및 드래그 이벤트 처리
- 잘못된 인터랙션에 대한 패널티 적용

### 2. ProcedureManager

프로시저 및 프로시저 스텝의 실행을 관리합니다.

주요 기능:
- 프로시저 시작 및 스텝 진행
- 각 스텝 타입에 맞는 처리
- 아이템 클릭, 액션 버튼 클릭, 플레이어 인터랙션 이벤트 처리
- 순서 확인 및 패널티 적용

### 3. PenaltyManager

패널티 적용 및 시각 효과를 관리합니다.

주요 기능:
- 패널티 메시지 표시
- 화면 가장자리 빨간색 깜빡임 효과
- 패널티 데이터베이스 기록

### 4. ScoringSystem

점수 계산 및 평가를 관리합니다.

주요 기능:
- 패널티에 따른 점수 감점
- 카테고리별 점수 추적
- 최종 점수 및 등급 평가

## 에디터 확장

각 데이터 타입에 맞는 커스텀 에디터를 제공하여 인스펙터에서 쉽게 데이터를 편집할 수 있습니다.

- `InteractionDataEditor`: 인터랙션 데이터 편집기
- `ProcedureDataEditor`: 프로시저 데이터 편집기
- `ProcedureTypeEditor`: 프로시저 타입 편집기

## 사용 방법

1. `Assets/Create/Nursing` 메뉴를 통해 새로운 데이터 에셋 생성
2. 인스펙터에서 데이터 구성
3. ProcedureType을 통해 프로시저 데이터 연결
4. ProcedureManager와 InteractionManager를 통해 게임 내에서 프로시저 실행

## 주의사항

- 기존 시스템에서 새 시스템으로 데이터를 마이그레이션해야 합니다.
- 대부분의 필드에 한글 레이블과 툴팁이 제공됩니다.
- 시각적 요소는 "set native size" 설정을 따릅니다.
- 오브젝트 위치 지정은 Transform을 사용합니다.
- GameObject에 태그를 통해 인터랙션 대상을 식별합니다.